D0000D发往论坛板块-------------------------------------------------------
No2  号板块  技术文章
D8888D贴子标题-------------------------------------------------------
一次运气入侵
D8888D主贴内容-------------------------------------------------------
 

以前的一次入侵经历，没有图，大概叙述一下过程，只为在论坛混点金币（o(s□t)o）
      某日，老大发过来一个搞证券的网站，说渗透成功的话可以跟他们有业务往来，于是开始检测，网站结构为windows2003+IIS6+aspx,说这是一次运气入侵，一开始简单看了看就找到了一处字符型注入点，db权限，不过接下来发现只有用啊D才可以成功列目录，并且每次只能列出一个目录，要刷新一下才能列出第二个，然后再刷新。。。不知其原因，导致用工具也跟手工差不多成了体力活，刷新了一阵后，列出几个文件夹都比较类似站点根目录，里面的文件几乎都相同，拿出来一个比较特殊的文件名访问，可以成功访问，每个目录里都备份一句话，备份成功，不过访问后都提示404错误。
      停滞思考一下，认为web和数据很有可能是分离的，于是select host_name();和select @@servername;看了一下发现返回的主机名不一样，果然是分离的，db权限，还是web和数据分离，正常的话这样会大大增加入侵的难度，我想很多朋友该开始去猜表名列名了，不过我前面说过有几个目录很像站点根目录，而且网站的文件目录里也都有，那么是否也能通过查找一些敏感文件（主要还是上传点）来从网站下手呢，结果RP爆发，admin的目录下发现了两个文件flashadd.aspx和flashmanage.aspx，两个文件均没有验证用户身份，前者可以上传文件任意文件（本地验证，很容易就KO掉），但上传后不提示文件地址，后者为管理上传的文件，恰巧可以看到上传后的文件地址，两者有机的结合在一起，很容易得到一个aspx的shell。windows的平台本人对aspx的shell很有亲切感，因为现在很多主机尤其是那些虚拟主机，大多数都禁掉了wscript.shell组件，不能执行命令，但是.net执行命令并不依赖wscript.shell，所以在那些禁用了wscript.shell组件的主机上如果解析aspx的话对下一步的提权是很大的福音。
      不过这个系统的提权没有费那么多力，可以用轻松加愉快来形容，上传一个巴西烤肉就解决问题了，而数据库服务器的那边也很顺利，我们在web服务器翻到了sa的账户，连上去怎么办大家心里都有数，反正结果就是也搞定了。最后就是交给老大去办业务了。
      一次很幸运的入侵，没有任何技术含量，运气也都取决于管理员对安全的不重视，其实感觉还有很多大企业的网络安全防线都很容易突破，例如我以前弄过的，某某集团主站后台万能密码就可以进去，上传点没做任何限制，因为是jsp的，所以直接拿到system权限，还有某大型企业，IBM刀片服务器一次性就能买450台，但是网站的后台密码还是admin。。。不过想想也挺好，没有这些不注重安全的管理员我们还怎么混饭吃，呵呵，事物都有两面性，最后一句，看完此文大家勿喷，只当娱乐罢了，希望斑竹加点钱，本人刚来论坛不久，穷死了。。。
